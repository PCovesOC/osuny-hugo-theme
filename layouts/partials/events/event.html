{{ $event := .event }}
{{ $layout := "list" }}
{{ $layout = .layout }}
{{- $direction := "" -}}
{{ $heading := .heading | default "h2" }}
{{ $heading_tag := (dict 
    "open" ((printf "<%s itemprop='headline'>" $heading) | safeHTML)
    "close" ((printf "</%s>" $heading) | safeHTML)
    ) }}
{{ $index := .index }}
{{ $alternate := .alternate }}

{{ with $event }}

{{ if .Params.image }}
  {{- $direction = partial "GetImageDirection" .Params.image -}}
{{ end }}

<article class="event" itemscope itemtype="https://schema.org/Event">
  <div class="event-content">
    {{- $title := partial "PrepareHTML" .Title -}}
    {{ if .Params.subtitle }}
      <hgroup>
    {{ end }}
    {{ $heading_tag.open }}
      <a href="{{ .Permalink }}" title="{{ safeHTML (i18n "commons.more_aria" (dict "Title" $title)) }}" itemprop="name">{{ $title }}</a>
    {{ $heading_tag.close }}
    {{ if .Params.subtitle }}
        <p class="event-subtitle">{{ .Params.subtitle }}</p>
      </hgroup>
    {{ end }}
    <p></p>

    {{ if eq $layout "large" }}
      <div class="event-dates meta" itemprop="startDate" content="{{- if .Params.dates.from.day -}}{{ .Params.dates.from.day }}{{- end -}} {{- if .Params.dates.from.hour -}}{{ .Params.dates.from.hour }}{{- end -}}">
        {{ .Params.dates.computed.short }}
        <div class="event-time">
          {{ if .Params.dates.from.hour }}
            <span>{{ .Params.dates.from.hour }}</span>
          {{ end }}
          {{ if .Params.dates.to.hour }}
            <span> {{ .Params.dates.to.hour }}</span>
          {{ end }}
        </div>
      </div>

      {{ if site.Params.events.index.show_description }}
        {{- if (partial "GetTextFromHTML" .Params.summary) -}}
          <p itemprop="description">
            {{ if site.Params.events.index.truncate_description }}
              {{ partial "GetTruncateContent" ( dict 
                "text" .Params.summary
                "length" site.Params.events.index.truncate_description
                ) }}
            {{ else }}
              {{ partial "PrepareText" .Params.summary }}
            {{ end }}
          </p>
        {{- end -}}
      {{- end -}}

      {{ if .Params.categories }}
        {{ range .Params.categories }}
          <p class="event-categories">{{ . }}</p>
        {{ end }}
      {{ end }}
  
      <p class="more meta" aria-hidden="true">{{- i18n "commons.more" -}}</p>
  {{ end }}
  </div>

  {{ if ne $layout "large" }}
    <div class="event-dates" itemprop="startDate" content="{{- if .Params.dates.from.day -}}{{ .Params.dates.from.day }}{{- end -}} {{- if .Params.dates.from.hour -}}{{ .Params.dates.from.hour }}{{- end -}}">
      {{ .Params.dates.computed.short }}
      <div class="event-time">
        {{ if .Params.dates.from.hour }}
          <span>{{ .Params.dates.from.hour }}</span>
        {{ end }}
        {{ if .Params.dates.to.hour }}
          <span> {{ .Params.dates.to.hour }}</span>
        {{ end }}
      </div>
    </div>

    {{ if and (site.Params.events.index.show_description) (eq $layout "grid") }}
      {{- if (partial "GetTextFromHTML" .Params.summary) -}}
        <div class="event-description">
          <p itemprop="description">
            {{ if site.Params.events.index.truncate_description }}
              {{ partial "GetTruncateContent" ( dict 
                "text" .Params.summary
                "length" site.Params.events.index.truncate_description
                ) }}
            {{ else }}
              {{ partial "PrepareText" .Params.summary }}
            {{ end }}
          </p>
        </div>
      {{- end -}}


      {{ if .Params.categories }}
        {{ range .Params.categories }}
          <p class="event-categories">{{ . }}</p>
        {{ end }}
      {{ end }}
    {{- end -}}
  {{ end }}

  <div class="media">
    {{- if .Params.image -}}
      {{- partial "commons/image.html"
            (dict
              "image"    .Params.image
              "sizes"    site.Params.image_sizes.sections.events.item
            ) -}}
    {{- else if site.Params.events.default_image -}}
      {{- partial "commons/image-default.html" -}}
    {{- end -}}
  </div>
</article>
{{ end }}