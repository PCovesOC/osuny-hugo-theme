{{- $template := .block.template -}}
{{- $position := .block.position -}}
{{- $title := .block.title -}}
{{ $logo_index := "logo" }}
{{ if site.Params.organizations.dark_logo_background }}
  {{ $logo_index = "logo_on_dark_background" }}
{{ end }}
{{- with .block.data -}}
  <section class="block block-partners{{ if $title }} block-with-title{{ end }}" id="block-{{ $position }}">
    <div class="container">
      <div class="block-content">
        {{ if (or $title .description) -}}
          <div class="top">
            {{- if not $title -}}
              {{ partial "blocks/default_title.html" $template }}
            {{ else }}
              <h2>{{ partial "PrepareHTML" $title }}</h2>
            {{ end -}}
            {{- if .description }}
              <div class="description">
                {{ partial "PrepareHTML" .description }}
              </div>
            {{ end -}}
          </div>
        {{- end }}

        <div class="organizations">
          {{- range .partners }}
            {{ if .slug }}
              {{ with (site.GetPage (printf "/organizations/%s" .slug )) }}
                {{ template "partner" (dict 
                    "title" .Title
                    "url" .Permalink
                    "logo" (index .Params $logo_index)
                  )}}
              {{ end }}
            {{ else }}
              {{ template "partner" (dict 
                  "title" .name
                  "url" .url
                  "external" true
                  "logo" .logo
                )}}
            {{ end }}
          {{ end -}}
        </div>
      </div>
    </div>
  </section>
{{- end -}}

{{- define "partner" -}}
<article class="organization">
  {{ $title := "" }}
  {{ if .title }}
    {{ $title = partial "PrepareHTML" .title -}}
    <h3>
      {{- if .url }}
        <a href="{{ .url }}" {{ if .external }} target="_blank" rel="noopener" {{ end }} title="{{ safeHTML (i18n "commons.link.blank_aria" (dict "Title" $title)) }}">
      {{ end -}}
        {{- $title -}}
      {{- if .url }}
        </a>
      {{ end -}}
    </h3>
  {{ end -}}
  <div class="media">
    {{- if .logo -}}
      {{- partial "commons/image.html"
        (dict
          "image"    .logo
          "alt"      $title
          "sizes"    site.Params.image_sizes.blocks.partners
        ) -}}
    {{- end -}}
  </div>
</article>
{{- end  -}}